(()=>{var e={};e.id=2607,e.ids=[2607],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},16429:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>l});var a=r(59743),i=r(23112),o=r(2567),n=r(85454);let u=process.env.FLASK_MAIL_SERVICE_URL||"http://localhost:5000";async function l(e){try{let t=await e.json(),{template:r,template_data:s,to_email:a,subject:i,fallback_html:o}=t;if(!a||!i)return n.NextResponse.json({error:"Missing required fields: to_email and subject are required"},{status:400});let l=await fetch(`${u}/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_email:a,subject:i,template:r,template_data:s,fallback_html:o})});if(!l.ok){let e=await l.json().catch(()=>({}));if(console.error("Flask Mail service error:",e),l.status>=500)return console.log("Flask Mail service unavailable, trying fallback..."),await c(t);return n.NextResponse.json({error:e.error||"Failed to send email"},{status:l.status})}let p=await l.json();return n.NextResponse.json({success:!0,message_id:p.message_id,service:"flask_mail"})}catch(e){console.error("Error sending email:",e);try{return await c(body)}catch(e){return console.error("Fallback email also failed:",e),n.NextResponse.json({error:"Email service unavailable"},{status:503})}}}async function c(e){let{createClient:t}=await Promise.all([r.e(7893),r.e(1725)]).then(r.bind(r,78286)),s=await t(),{data:a,error:i}=await s.auth.admin.sendRawEmail({to:e.to_email,subject:e.subject,html:e.fallback_html||e.template_data?.content||"Email content not available"});if(i)throw i;return n.NextResponse.json({success:!0,message_id:a?.message_id,service:"supabase_fallback"})}async function p(e){try{let e=await fetch(`${u}/health`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)return n.NextResponse.json({status:"unhealthy",service:"flask_mail",error:"Service not responding"},{status:503});let t=await e.json();return n.NextResponse.json({status:"healthy",service:"flask_mail",details:t})}catch(e){return console.error("Health check failed:",e),n.NextResponse.json({status:"unhealthy",service:"flask_mail",error:"Connection failed"},{status:503})}}let d=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/send-email/route",pathname:"/api/send-email",filename:"route",bundlePath:"app/api/send-email/route"},resolvedPagePath:"/Users/yatishgrandhe/Downloads/Stem-Spark-main/app/api/send-email/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:x}=d;function f(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},27910:e=>{"use strict";e.exports=require("stream")},28187:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81331:()=>{},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1703,9600],()=>r(16429));module.exports=s})();
(()=>{var e={};e.id=5324,e.ids=[1725,5324],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19901:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>o,uO:()=>s});var a=t(78286);async function s(e){try{let e=(0,a.createClient)(),{data:{user:r},error:t}=await e.auth.getUser();if(t||!r)return{error:"Unauthorized",status:401};let{data:s,error:n}=await e.from("profiles").select("role, is_super_admin").eq("id",r.id).single();if(n||!s)return{error:"Profile not found",status:404};if("admin"!==s.role&&!s.is_super_admin)return{error:"Admin access required",status:403};return{user:r,profile:s,error:null}}catch(e){return{error:"Internal server error",status:500}}}t(85454);class n{async getAdminActionLogs(e=100){try{let{data:r,error:t}=await this.supabase.from("admin_actions_log").select(`
          *,
          performed_by:profiles!admin_actions_log_performed_by_fkey(full_name, email),
          target_user:profiles!admin_actions_log_target_user_id_fkey(full_name, email)
        `).order("created_at",{ascending:!1}).limit(e);if(t)throw t;return r||[]}catch(e){throw console.error("Error fetching admin action logs:",e),e}}async logAdminAction(e,r,t,a,s=!0,n){try{let{error:o}=await this.supabase.from("admin_actions_log").insert({action_type:e,performed_by:r,target_user_id:t,metadata:a,is_allowed:s,reason:n});if(o)throw o}catch(e){throw console.error("Error logging admin action:",e),e}}async validateAdminAccess(e){try{let{data:r,error:t}=await this.supabase.from("profiles").select("role, is_super_admin").eq("id",e).single();if(t||!r)return{isValid:!1,reason:"Profile not found"};if("admin"!==r.role&&!r.is_super_admin)return{isValid:!1,reason:"Admin access required"};return{isValid:!0,profile:r}}catch(e){return console.error("Error validating admin access:",e),{isValid:!1,reason:"Error validating access"}}}async canEditUser(e,r){try{let{data:t,error:a}=await this.supabase.from("profiles").select("role, is_super_admin").eq("id",e).single();if(a||!t)return{canEdit:!1,reason:"Current user not found"};if("admin"!==t.role&&!t.is_super_admin)return{canEdit:!1,reason:"Insufficient permissions"};if(e===r)return{canEdit:!0};let{data:s,error:n}=await this.supabase.from("profiles").select("role, is_super_admin").eq("id",r).single();if(n||!s)return{canEdit:!1,reason:"Target user not found"};if(t.is_super_admin)return{canEdit:!0};if("admin"===s.role||s.is_super_admin)return{canEdit:!1,reason:"Cannot edit other administrators"};return{canEdit:!0}}catch(e){return console.error("Error checking admin edit permissions:",e),{canEdit:!1,reason:"Error checking permissions"}}}constructor(){this.supabase=(0,a.createClient)()}}let o=n},27910:e=>{"use strict";e.exports=require("stream")},28187:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50253:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56836:()=>{},60931:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=60931,e.exports=r},61493:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>_,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var a={};t.r(a),t.d(a,{GET:()=>d,POST:()=>l});var s=t(59743),n=t(23112),o=t(2567),i=t(85454),c=t(78286),u=t(19901);async function d(e){try{let{user:e,error:r}=await (0,u.uO)();if(r)return i.NextResponse.json({error:r},{status:401});let t=(0,c.createClient)(),a={timestamp:new Date().toISOString(),cpu:100*Math.random(),memory:100*Math.random(),disk:100*Math.random(),network:100*Math.random(),activeUsers:Math.floor(100*Math.random())+10,uptime:Math.floor(1e6*Math.random())},{data:s,error:n}=await t.from("analytics_events").select("*").gte("created_at",new Date(Date.now()-864e5).toISOString()).order("created_at",{ascending:!0});n&&console.error("Error fetching performance data:",n);let o=s?.filter(e=>"page_load"===e.event_type)||[],d=s?.filter(e=>"api_call"===e.event_type)||[],l=s?.filter(e=>"database_query"===e.event_type)||[],p={totalEvents:s?.length||0,pageLoads:{count:o.length,averageDuration:o.length>0?o.reduce((e,r)=>e+(r.metadata?.duration||0),0)/o.length:0},apiCalls:{count:d.length,averageDuration:d.length>0?d.reduce((e,r)=>e+(r.metadata?.duration||0),0)/d.length:0},databaseQueries:{count:l.length,averageDuration:l.length>0?l.reduce((e,r)=>e+(r.metadata?.duration||0),0)/l.length:0}},{data:m,error:f}=await t.from("admin_actions_log").select("*").eq("action_type","system_alert").order("created_at",{ascending:!1}).limit(10);f&&console.error("Error fetching alerts:",f);let{data:_,error:g}=await t.from("analytics_events").select("user_id, event_type, created_at").gte("created_at",new Date(Date.now()-36e5).toISOString()).order("created_at",{ascending:!1});g&&console.error("Error fetching user activity:",g);let h=new Set(_?.map(e=>e.user_id)||[]).size;return i.NextResponse.json({systemMetrics:{...a,activeUsers:h},performanceMetrics:p,alerts:m||[],userActivity:_||[],lastUpdated:new Date().toISOString()})}catch(e){return console.error("Error in performance monitoring API:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{user:r,error:t}=await (0,u.uO)();if(t)return i.NextResponse.json({error:t},{status:401});let{action:a,data:s}=await e.json(),n=(0,c.createClient)();switch(a){case"clear_cache":return i.NextResponse.json({success:!0,message:"Cache cleared successfully"});case"generate_report":let{data:o,error:d}=await n.from("analytics_events").select("*").gte("created_at",new Date(Date.now()-6048e5).toISOString());if(d)throw Error("Failed to fetch events for report");let l={totalEvents:o?.length||0,eventsByType:o?.reduce((e,r)=>(e[r.event_type]=(e[r.event_type]||0)+1,e),{})||{},averageResponseTime:o?.length>0?o.reduce((e,r)=>e+(r.metadata?.duration||0),0)/o.length:0,generatedAt:new Date().toISOString()};return i.NextResponse.json({success:!0,report:l});case"update_thresholds":let{cpu:p,memory:m,disk:f,network:_}=s;return i.NextResponse.json({success:!0,message:"Thresholds updated successfully",thresholds:{cpu:p,memory:m,disk:f,network:_}});default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in performance monitoring API:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/performance/route",pathname:"/api/admin/performance",filename:"route",bundlePath:"app/api/admin/performance/route"},resolvedPagePath:"/Users/yatishgrandhe/Downloads/Stem-Spark-main/app/api/admin/performance/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:_}=p;function g(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78286:(e,r,t)=>{"use strict";t.d(r,{createClient:()=>n});var a=t(72831),s=t(62519);function n(){let e=(0,s.UL)();return(0,a.Ri)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:a})=>e.set(r,t,a))}catch{}}}})}},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81331:()=>{},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1703,7893,9600],()=>t(61493));module.exports=a})();
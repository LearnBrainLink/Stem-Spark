(()=>{var e={};e.id=9077,e.ids=[1725,9077],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},13472:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>u});var a=r(59743),n=r(23112),o=r(2567),i=r(85454),c=r(78286);async function u(e){try{let t=await (0,c.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{event_type:s,event_data:a,page_url:n,user_agent:o,timestamp:u,session_id:l}=await e.json();if(!s||!a)return i.NextResponse.json({error:"Missing required fields: event_type and event_data"},{status:400});let{data:p}=await t.from("profiles").select("analytics_consent").eq("id",r.id).single();if(!p?.analytics_consent)return i.NextResponse.json({error:"Analytics consent required"},{status:403});let{error:d}=await t.from("analytics_events").insert({user_id:r.id,event_type:s,event_data:a,page_url:n||null,user_agent:o||null,timestamp:u||new Date().toISOString(),session_id:l||null,created_at:new Date().toISOString()});if(d)return console.error("Error storing analytics event:",d),i.NextResponse.json({error:"Failed to store analytics event"},{status:500});return i.NextResponse.json({success:!0,message:"Analytics event recorded"})}catch(e){return console.error("Error in analytics collection:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=await (0,c.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:s}=await t.from("profiles").select("role").eq("id",r.id).single();if(!s||"admin"!==s.role&&"super_admin"!==s.role)return i.NextResponse.json({error:"Forbidden"},{status:403});let{searchParams:a}=new URL(e.url),n=a.get("time_range")||"7d",o=a.get("event_type"),u=parseInt(a.get("limit")||"100"),l=new Date,p=new Date;switch(n){case"1d":p.setDate(l.getDate()-1);break;case"7d":default:p.setDate(l.getDate()-7);break;case"30d":p.setDate(l.getDate()-30);break;case"90d":p.setDate(l.getDate()-90)}let d=t.from("analytics_events").select("*").gte("created_at",p.toISOString()).order("created_at",{ascending:!1}).limit(u);o&&(d=d.eq("event_type",o));let{data:x,error:g}=await d;if(g)return console.error("Error fetching analytics events:",g),i.NextResponse.json({error:"Failed to fetch analytics events"},{status:500});return i.NextResponse.json({success:!0,events:x||[],time_range:n,total_count:x?.length||0})}catch(e){return console.error("Error fetching analytics:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analytics/collect/route",pathname:"/api/analytics/collect",filename:"route",bundlePath:"app/api/analytics/collect/route"},resolvedPagePath:"/Users/yatishgrandhe/Downloads/Stem-Spark-main/app/api/analytics/collect/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:x,serverHooks:g}=p;function y(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:x})}},27910:e=>{"use strict";e.exports=require("stream")},28187:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50253:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56836:()=>{},60931:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=60931,e.exports=t},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78286:(e,t,r)=>{"use strict";r.d(t,{createClient:()=>n});var s=r(72831),a=r(62519);function n(){let e=(0,a.UL)();return(0,s.Ri)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81331:()=>{},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1703,7893,9600],()=>r(13472));module.exports=s})();
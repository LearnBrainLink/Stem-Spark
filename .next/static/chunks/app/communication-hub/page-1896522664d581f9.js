(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9959],{19266:(e,s,a)=>{"use strict";a.d(s,{U:()=>i});var t=a(93579),n=a(53045);let l=n.env.NEXT_PUBLIC_SUPABASE_URL,r=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,i=()=>(0,t.UU)(l,r)},85491:(e,s,a)=>{Promise.resolve().then(a.bind(a,91788))},91788:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});var t=a(81767),n=a(13647),l=a(19266);function r(){var e;let[s,a]=(0,n.useState)([]),[r,i]=(0,n.useState)([]),[d,c]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[o,h]=(0,n.useState)(null),[u,p]=(0,n.useState)(""),f=(0,l.U)();(0,n.useEffect)(()=>{g(),y()},[]),(0,n.useEffect)(()=>{d&&(b(d),v(d))},[d]);let g=async()=>{let{data:{user:e}}=await f.auth.getUser();if(e){h(e);let{data:s}=await f.from("profiles").select("role").eq("id",e.id).single();p((null==s?void 0:s.role)||"")}},y=async()=>{let{data:e,error:s}=await f.from("channels").select("*").order("name");!s&&e&&(a(e),e.length>0&&c(e[0].id))},b=async e=>{let{data:s,error:a}=await f.from("messages").select("\n        *,\n        profiles:profiles(full_name)\n      ").eq("channel_id",e).order("created_at",{ascending:!0});!a&&s&&i(s.map(e=>{var s;return{...e,sender_name:(null==(s=e.profiles)?void 0:s.full_name)||"Unknown"}}))},v=e=>{let s=f.channel("messages:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"channel_id=eq.".concat(e)},e=>{let s=e.new;i(e=>[...e,s])}).subscribe();return()=>s.unsubscribe()},N=async()=>{if(!m.trim()||!o||!d)return;let{error:e}=await f.from("messages").insert([{content:m,sender_id:o.id,channel_id:d}]);e||x("")};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Communication Hub"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Connect with teachers, parents, and administrators"})]}),(0,t.jsxs)("div",{className:"flex h-96",children:[(0,t.jsx)("div",{className:"w-64 border-r border-gray-200 bg-gray-50",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Channels"}),(0,t.jsx)("div",{className:"space-y-2",children:s.filter(e=>"admin_only"!==e.type||"admin"===u).map(e=>(0,t.jsxs)("button",{onClick:()=>c(e.id),className:"w-full text-left px-3 py-2 rounded-md text-sm ".concat(d===e.id?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),children:[(0,t.jsxs)("div",{className:"font-medium",children:["#",e.name]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]},e.id))})]})}),(0,t.jsx)("div",{className:"flex-1 flex flex-col",children:d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:r.map(e=>(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium",children:e.sender_name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.sender_name}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]}),(0,t.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.content})]})]},e.id))}),(0,t.jsx)("div",{className:"border-t border-gray-200 p-4",children:"admin_only"!==(e=s.find(e=>e.id===d)).type&&"announcements"!==e.type||"admin"===u?(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),onKeyPress:e=>"Enter"===e.key&&N(),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,t.jsx)("button",{onClick:N,disabled:!m.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:"Send"})]}):(0,t.jsx)("div",{className:"text-sm text-gray-500 text-center py-2",children:"You don't have permission to send messages in this channel"})})]})})]})]})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[3579,6721,3664,7358],()=>s(85491)),_N_E=e.O()}]);